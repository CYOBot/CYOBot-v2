"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[82],{7082:function(e,t,a){a.r(t),a.d(t,{CodeEditor:function(){return K}});var s=a(9219),i=a(8993),o=a(4096),l=a(8266),r=a(9854),n=a(2564),c=a(1962);let d=r.fC,u=n.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,s.jsx)(r.aV,{ref:t,className:(0,c.cn)("inline-flex h-10 items-center justify-center bg-muted p-1 text-muted-foreground",a),...i})});u.displayName=r.aV.displayName;let v=n.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,s.jsx)(r.xz,{ref:t,className:(0,c.cn)("inline-flex items-center justify-center whitespace-nowrap px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",a),...i})});v.displayName=r.xz.displayName;let f=n.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,s.jsx)(r.VY,{ref:t,className:(0,c.cn)("ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...i})});f.displayName=r.VY.displayName;var m=a(6523),p=a(9187),h=a(6736),x=a(9718);let g=()=>{let{activeFilesStack:e,setActiveFilesStack:t}=(0,n.useContext)(h.J),a=e=>{localStorage.setItem(p._.localStorage.cyobot_local_storage_active_files_stack,JSON.stringify(e.getElements()))};return(0,n.useEffect)(()=>{let e=localStorage.getItem(p._.localStorage.cyobot_local_storage_active_files_stack);if(e){let a=JSON.parse(e);t(new x.K(a))}},[t]),{activeFilesStack:e,pushActiveFile:s=>{e.push(s);let i=new x.K(e.getElements());t(i),a(i)},popActiveFile:()=>{e.pop();let s=new x.K(e.getElements());t(s),a(s)},removeActiveFile:s=>{e.removeById(s);let i=new x.K(e.getElements());t(i),a(i)}}};var b=a(1382);let y=e=>{let[t,a]=(0,n.useState)(""),[s,i]=(0,n.useState)("");return(0,n.useEffect)(()=>{let t=e.findIndex(e=>"OK"===e);if(-1===t){a(""),i("");return}let s=e.findIndex(e=>"\x04"===e);if(-1===s){a(e.slice(t+1).join("").trim());return}let o=e.findLastIndex(e=>"\x04"===e);if(s===o-1)a(e.slice(t+1,s).join("").trim());else{if(-1===o)throw"lastEndOfTransmissionIndex should not be -1 if an error occur in user code";i(e.slice(s+1,o).join("").trim())}},[e]),{consoleOutput:t,setConsoleOutput:a,consoleErrorOutput:s,setConsoleErrorOutput:i}};var w=a(6190),j=a(1057),N=a(7233),k=a(1392),_=a(1927),C=a(1310),S=a(5814),E=a(6078),R=a(3380),z=a(8553),I=a(5756),O=a(5095),P=a(3887),Z=a(4898),D=a(8004),T=a(7523),F=a(9439),V=a(5772);let K=()=>{var e,t,a;let[r,c]=(0,n.useState)(200),[h,x]=(0,n.useState)(!1),K=(0,n.useRef)(null),[L,U]=(0,n.useState)(0);(0,n.useEffect)(()=>{let e=()=>{K.current&&U(K.current.clientHeight)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]);let A="main",{activeFilesStack:J,popActiveFile:$,pushActiveFile:B,removeActiveFile:M}=g(),{openedFiles:G,removeOpenedFile:H}=(0,N.O)(),[Y,W]=(0,n.useState)(null!==(a=null===(e=J.peek())||void 0===e?void 0:e.id)&&void 0!==a?a:A),q=e=>{var t,a,s;e===(null===(t=J.peek())||void 0===t?void 0:t.id)?$():M(e),H(e),W(null!==(s=null===(a=J.peek())||void 0===a?void 0:a.id)&&void 0!==s?s:A)},Q=e=>{J.findById(e.id)&&M(e.id),B(e),W(e.id)},{toast:X,dismiss:ee}=(0,S.pm)(),{robotIPAddress:et}=(0,C.W)(),{code:ea,setCode:es}=(0,b.h)();(0,n.useEffect)(()=>{""===ea&&es('print("hello world")')},[]);let{client:ei}=(0,k.x)(),{clientResponses:eo,setClientResponses:el}=(0,_.v)(),[er,en]=(0,j._)(p._.localStorage.cyobot_local_storage_code_executing,!1),[ec,ed]=(0,j._)(p._.localStorage.cyobot_local_storage_code_deploying,!1),[eu,ev]=(0,j._)(p._.localStorage.cyobot_local_storage_code_saving,!1),[ef,em]=(0,j._)(p._.localStorage.cyobot_local_storage_code_loading,!1);(0,n.useEffect)(()=>{ei.addOnMessageReceiveCallback("onMessageReceive",e=>{"STARTCODERUNNING"===e?en(!0):"ENDCODERUNNING"===e?en(!1):el(t=>[...t,e])})},[ei,el,en]);let{consoleOutput:ep,consoleErrorOutput:eh}=y(eo),ex=(0,n.useRef)(null);(0,n.useEffect)(()=>{var e;null===(e=ex.current)||void 0===e||e.scrollIntoView()},[ep,eh]);let eg=(0,n.useCallback)(()=>{ei.send(ea),el([])},[ei,ea,el]),eb=(0,n.useCallback)(()=>{ei.interrupt(),en(!1)},[ei,en]),ey=(0,n.useCallback)(async(e,t,a)=>{if(ec)try{let s=await z.Z.post("".concat(null===et?"":"http://".concat(et),"/api/deploy"),{code:e},{headers:{"Content-Type":"text/plain"}});if(200!==s.status)throw s;if('"fail"'==s.data){t(!1),a({title:"Error: Fail to deploy",description:"Please try again",variant:"destructive"});return}a({title:"Success",description:"Deployed code"}),t(!1)}catch(e){t(!1),console.error(e),a({title:"Uh oh, something went wrong...",description:"Please try again",variant:"destructive"});return}},[ec,et]),{refetchLoad:ew}=(0,w.d)(),ej=(0,n.useCallback)(async(e,t,a)=>{if(eu)try{let s=await z.Z.post("".concat(null===et?"":"http://".concat(et),"/api/save"),{code:e},{headers:{"Content-Type":"text/plain"}});if(200!==s.status)throw s;if('"fail"'==s.data){t(!1),a({title:"Error: Fail to save",description:"Please try again",variant:"destructive"});return}a({title:"Success",description:"Saved code"}),t(!1)}catch(e){t(!1),console.error(e),a({title:"Uh oh, something went wrong...",description:"Please try again",variant:"destructive"});return}},[eu,et]);(0,n.useEffect)(()=>{eu&&ej(ea,ev,X)},[ea,eu,ej,ev,X]);let[eN,ek]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{ec&&ey(ea,ed,X)},[ea,ec,ey,ed,X]),(0,s.jsxs)("div",{ref:K,className:"pl-6 w-full h-full flex flex-col",children:[(0,s.jsxs)(d,{className:"h-full overflow-hidden",value:Y,children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)(m.k,{children:"Code Editor"}),(0,s.jsxs)("div",{className:"flex gap-x-4",children:[(0,s.jsxs)(o.z,{variant:"outline",className:"text-primary ".concat(eu||Y!==A?"bg-background/50 hover:bg-background/50 backdrop-blur-md cursor-not-allowed":"cursor-pointer"),onClick:()=>{Y===A&&("connected"!==ei.status?X({title:"Robot is not connected",description:"Please connect your robot to save",variant:"destructive"}):(ee(),ev(!0)))},children:[eu?(0,s.jsx)(l.$,{className:"h-4 w-4 mr-1.5"}):(0,s.jsx)(I.Z,{className:"h-4 w-4 mr-1.5"}),"Save"]}),(0,s.jsxs)(o.z,{variant:"outline",className:"text-primary ".concat(ef||Y!==A?"bg-background/50 hover:bg-background/50 backdrop-blur-md cursor-not-allowed":"cursor-pointer"),onClick:async()=>{if(Y===A){if("connected"!==ei.status)X({title:"Robot is not connected",description:"Please connect your robot to load",variant:"destructive"});else{ee(),em(!0);try{await ew()}catch(e){console.error(e),X({title:"Uh oh, something went wrong...",description:"Please try again",variant:"destructive"})}finally{em(!1)}}}},children:[ef?(0,s.jsx)(l.$,{className:"h-4 w-4 mr-1.5"}):(0,s.jsx)(O.Z,{className:"h-4 w-4 mr-1.5"}),"Load"]})]})]}),G.length>0&&(0,s.jsx)(u,{className:"pb-0 rounded-t-lg w-fit","aria-label":"Manage your tabs",children:G.map(e=>(0,s.jsxs)(v,{className:"".concat(e.id===A?"data-[state=active]:text-white text-white data-[state=active]:pb-2 data-[state=active]:pt-1 data-[state=active]:border-b-4 border-white data-[state=active]:bg-primary bg-primary/30":"data-[state=active]:pb-4","  transition ease-linear data-[state=active]:h-11 data-[state=active]:shadow-none data-[state=active]:relative top-1 z-10 py-2 rounded-t-md flex justify-between items-center gap-x-2"),value:e.id,children:[(0,s.jsx)("span",{onClick:()=>Q(e),className:"w-20 truncate",children:e.id}),e.id!==A&&(0,s.jsx)(P.Z,{className:"w-4 h-4",onClick:()=>q(e.id)}),(0,s.jsx)("span",{className:"sr-only",children:"Close tab"})]},e.id))}),(0,s.jsxs)(f,{className:"h-[calc(100%-40px-48px)] relative",value:Y,children:[(0,s.jsx)("div",{className:"pt-1 absolute top-0 overflow-y-auto rounded-b-lg w-full h-[calc(100%-40px-12px)] bg-muted",children:(0,s.jsx)(R.ZP,{readOnly:Y!==A,className:"text-lg",value:Y===A?ea:null===(t=J.peek())||void 0===t?void 0:t.content,onChange:es,extensions:[(0,E.Vs)()]})}),(0,s.jsx)("div",{className:"absolute bottom-0 w-full flex justify-end",children:(0,s.jsxs)(o.z,{className:"".concat(ec||Y!==A?"cursor-not-allowed bg-muted/50 hover:bg-muted/50":"cursor-pointer"," "),variant:"muted",onClick:()=>{Y===A&&es("")},children:[(0,s.jsx)(Z.Z,{className:"h-4 w-4 mr-1.5"}),"Clear"]})})]})]}),(0,s.jsxs)("div",{className:"relative flex flex-col",children:[(0,s.jsx)(m.k,{className:"mb-2",children:"Console"}),(0,s.jsx)(V.Resizable,{handle:(0,s.jsx)("span",{className:"absolute left-0 top-0 z-50 w-full h-2 cursor-row-resize ".concat(h?"bg-secondary":"","  rounded-lg")}),axis:"y",height:r,onResizeStart:()=>{x(!0)},onResize:(e,t)=>{c(t.size.height)},onResizeStop:()=>{x(!1)},resizeHandles:["n"],maxConstraints:[0,L-28-8],children:(0,s.jsxs)("div",{className:"relative w-full bg-muted px-4 py-2 whitespace-pre-line font-mono rounded-lg overflow-y-auto",style:{height:r},children:[(0,s.jsx)("div",{className:"text-primary",children:ep}),(0,s.jsx)("div",{className:"text-destructive",children:eh}),(0,s.jsx)("div",{ref:ex})]})}),(0,s.jsxs)("div",{className:"absolute -bottom-12 w-full flex flex-row justify-end space-x-4",children:[(0,s.jsxs)(o.z,{variant:"destructive",className:"text-background ".concat(ec||Y!==A?"cursor-not-allowed hover:bg-destructive/50 bg-destructive/50":"bg-destructive"),onClick:()=>{if(Y===A){if("connected"!==ei.status){X({title:"Robot is not connected",description:"Please connect your robot to break",variant:"destructive"});return}eb()}},children:[(0,s.jsx)(D.Z,{className:"h-4 w-4 mr-1.5"}),"Break"]}),(0,s.jsxs)(o.z,{variant:"positive",className:"".concat(er||ec||Y!==A?"bg-positive/30 hover:bg-positive/30 backdrop-blur-md cursor-not-allowed":"text-primary cursor-pointer"),onClick:()=>{ec||er||Y!==A||("connected"!==ei.status?X({title:"Robot is not connected",description:"Please connect your robot to run",variant:"destructive"}):(ee(),eg()))},children:[er?(0,s.jsx)(l.$,{className:"h-4 w-4 mr-1.5"}):(0,s.jsx)(T.Z,{className:"h-4 w-4 mr-1.5"}),"Run"]}),(0,s.jsxs)(o.z,{variant:"secondary",className:"".concat(ec||er||Y!==A?"bg-secondary/50 hover:bg-secondary/50 backdrop-blur-md cursor-not-allowed":"cursor-pointer"),onClick:()=>{ec||er||Y!==A||("connected"!==ei.status?X({title:"Robot is not connected",description:"Please connect your robot to deploy",variant:"destructive"}):(ee(),ek(!0)))},children:[(0,s.jsx)(F.Z,{className:"h-4 w-4 mr-1.5"}),"Deploy"]})]})]}),(0,s.jsx)(i.aR,{open:eN,onOpenChange:ek,children:(0,s.jsxs)(i.zJ,{children:[(0,s.jsx)(i.dh,{}),(0,s.jsxs)(i._T,{children:[(0,s.jsx)(i.f$,{children:"Confirm Code Deployment"}),(0,s.jsx)(i.yT,{children:"Deploying this code will overwrite the portal feature. Do you want to continue?"}),(0,s.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,s.jsx)(i.le,{onClick:()=>{ed(!1)},children:"Cancel"}),(0,s.jsx)(i.OL,{onClick:()=>{ed(!0)},children:"Confirm"})]})]})]})})]})}}}]);