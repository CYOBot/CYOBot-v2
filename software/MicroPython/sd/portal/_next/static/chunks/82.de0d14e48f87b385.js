"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[82],{7082:function(e,t,s){s.r(t),s.d(t,{CodeEditor:function(){return Y}});var a=s(9219),i=s(8993),l=s(4096),r=s(8266),n=s(9854),c=s(2564),o=s(1962);let d=n.fC,u=c.forwardRef((e,t)=>{let{className:s,...i}=e;return(0,a.jsx)(n.aV,{ref:t,className:(0,o.cn)("inline-flex h-10 items-center justify-center bg-muted p-1 text-muted-foreground",s),...i})});u.displayName=n.aV.displayName;let _=c.forwardRef((e,t)=>{let{className:s,...i}=e;return(0,a.jsx)(n.xz,{ref:t,className:(0,o.cn)("inline-flex items-center justify-center whitespace-nowrap px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...i})});_.displayName=n.xz.displayName;let T=c.forwardRef((e,t)=>{let{className:s,...i}=e;return(0,a.jsx)(n.VY,{ref:t,className:(0,o.cn)("ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...i})});T.displayName=n.VY.displayName;var E=s(6523),v=s(9187),f=s(6736),m=s(9718);let S=()=>{let{activeFilesStack:e,setActiveFilesStack:t}=(0,c.useContext)(f.J),s=e=>{localStorage.setItem(v._.localStorage.cyobot_local_storage_active_files_stack,JSON.stringify(e.getElements()))};return(0,c.useEffect)(()=>{let e=localStorage.getItem(v._.localStorage.cyobot_local_storage_active_files_stack);if(e){let s=JSON.parse(e);t(new m.K(s))}},[t]),{activeFilesStack:e,pushActiveFile:a=>{e.push(a);let i=new m.K(e.getElements());t(i),s(i)},popActiveFile:()=>{e.pop();let a=new m.K(e.getElements());t(a),s(a)},removeActiveFile:a=>{e.removeById(a);let i=new m.K(e.getElements());t(i),s(i)}}};var N=s(1382);let x=e=>{let[t,s]=(0,c.useState)(""),[a,i]=(0,c.useState)("");return(0,c.useEffect)(()=>{let t=e.findIndex(e=>"OK"===e);if(-1===t){s(""),i("");return}let a=e.findIndex(e=>"\x04"===e);if(-1===a){s(e.slice(t+1).join("").trim());return}let l=e.findLastIndex(e=>"\x04"===e);if(a===l-1)s(e.slice(t+1,a).join("").trim());else{if(-1===l)throw"lastEndOfTransmissionIndex should not be -1 if an error occur in user code";i(e.slice(a+1,l).join("").trim())}},[e]),{consoleOutput:t,setConsoleOutput:s,consoleErrorOutput:a,setConsoleErrorOutput:i}};var p=s(6190),O=s(1057),h=s(7233),C=s(1392),g=s(1927),b=s(1310),j=s(5244),D=s(5814),w=s(6078),I=s(3380),R=s(8553),y=s(5756),A=s(5095),k=s(3887),L=s(4898),P=s(8004),z=s(7523),K=s(9439),U=s(3328),V=s(5772);let Y=()=>{var e,t,s;let{t:n}=(0,j.N)(),[o,f]=(0,c.useState)(200),[m,Y]=(0,c.useState)(!1),W=(0,c.useRef)(null),[Z,F]=(0,c.useState)(0);(0,c.useEffect)(()=>{let e=()=>{W.current&&F(W.current.clientHeight)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]);let B="main",{activeFilesStack:M,popActiveFile:J,pushActiveFile:$,removeActiveFile:G}=S(),{openedFiles:H,removeOpenedFile:q}=(0,h.O)(),[Q,X]=(0,c.useState)(null!==(s=null===(e=M.peek())||void 0===e?void 0:e.id)&&void 0!==s?s:B),ee=e=>{var t,s,a;e===(null===(t=M.peek())||void 0===t?void 0:t.id)?J():G(e),q(e),X(null!==(a=null===(s=M.peek())||void 0===s?void 0:s.id)&&void 0!==a?a:B)},et=e=>{M.findById(e.id)&&G(e.id),$(e),X(e.id)},{toast:es,dismiss:ea}=(0,D.pm)(),{robotIPAddress:ei}=(0,b.W)(),{code:el,setCode:er}=(0,N.h)();(0,c.useEffect)(()=>{""===el&&er('print("hello world")')},[]);let{client:en}=(0,C.x)(),{clientResponses:ec,setClientResponses:eo}=(0,g.v)(),[ed,eu]=(0,O._)(v._.localStorage.cyobot_local_storage_code_executing,!1),[e_,eT]=(0,O._)(v._.localStorage.cyobot_local_storage_code_deploying,!1),[eE,ev]=(0,O._)(v._.localStorage.cyobot_local_storage_code_saving,!1),[ef,em]=(0,O._)(v._.localStorage.cyobot_local_storage_code_loading,!1);(0,c.useEffect)(()=>{en.addOnMessageReceiveCallback("onMessageReceive",e=>{"STARTCODERUNNING"===e?eu(!0):"ENDCODERUNNING"===e?eu(!1):eo(t=>[...t,e])})},[en,eo,eu]);let{consoleOutput:eS,consoleErrorOutput:eN}=x(ec),ex=(0,c.useRef)(null);(0,c.useEffect)(()=>{var e;null===(e=ex.current)||void 0===e||e.scrollIntoView()},[eS,eN]);let ep=(0,c.useCallback)(()=>{en.send(el),eo([])},[en,el,eo]),eO=(0,c.useCallback)(()=>{en.interrupt(),eu(!1)},[en,eu]),eh=(0,c.useCallback)(async(e,t,s)=>{if(e_)try{let a=await R.Z.post("".concat(null===ei?"":"http://".concat(ei),"/api/deploy"),{code:e},{headers:{"Content-Type":"text/plain"}});if(200!==a.status)throw a;if('"fail"'==a.data){t(!1),s({title:n("TOAST_DEPLOY_CODE_FAIL_TITLE"),description:n("TOAST_DEPLOY_CODE_FAIL_DESCRIPTION"),variant:"destructive"});return}s({title:n("TOAST_DEPLOY_CODE_SUCCESS_TITLE"),description:n("TOAST_DEPLOY_CODE_SUCCESS_DESCRIPTION")}),t(!1)}catch(e){t(!1),console.error(e),s({title:n("TOAST_DEPLOY_CODE_ERROR_TITLE"),description:n("TOAST_DEPLOY_CODE_ERROR_DESCRIPTION"),variant:"destructive"});return}},[e_,ei,n]),{refetchLoad:eC}=(0,p.d)(),eg=(0,U.useMutation)({mutationKey:"saveCode",mutationFn:async()=>{eE&&await R.Z.post("".concat(null===ei?"":"http://".concat(ei),"/api/save"),{code:el},{headers:{"Content-Type":"text/plain"}})},onSettled:()=>{ev(!1)},onSuccess:async()=>{es({title:n("TOAST_SAVE_CODE_SUCCESS_TITLE"),description:n("TOAST_SAVE_CODE_SUCCESS_DESCRIPTION")})},onError:()=>{es({title:n("TOAST_SAVE_CODE_ERROR_TITLE"),description:n("TOAST_SAVE_CODE_ERROR_DESCRIPTION"),variant:"destructive"})}}),[eb,ej]=(0,c.useState)(!1);return(0,c.useEffect)(()=>{e_&&eh(el,eT,es)},[el,e_,eh,eT,es]),(0,a.jsxs)("div",{ref:W,className:"px-6 w-full h-full flex flex-col",children:[(0,a.jsxs)(d,{className:"h-full overflow-hidden",value:Q,children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)(E.k,{children:n("CODE_EDITOR")}),(0,a.jsxs)("div",{className:"flex gap-x-4",children:[(0,a.jsxs)(l.z,{variant:"outline",className:"text-primary ".concat(eE||Q!==B?"bg-background/50 hover:bg-background/50 backdrop-blur-md cursor-not-allowed":"cursor-pointer"),onClick:()=>{Q===B&&("connected"!==en.status?es({title:n("TOAST_NETWORK_STATUS_DISCONNECTED_TITLE"),description:n("TOAST_NETWORK_STATUS_DISCONNECTED_SAVE_DESCRIPTION"),variant:"destructive"}):(ea(),ev(!0),eg.mutate()))},children:[eE?(0,a.jsx)(r.$,{className:"h-4 w-4 mr-1.5"}):(0,a.jsx)(y.Z,{className:"h-4 w-4 mr-1.5"}),n("SAVE")]}),(0,a.jsxs)(l.z,{variant:"outline",className:"text-primary ".concat(ef||Q!==B?"bg-background/50 hover:bg-background/50 backdrop-blur-md cursor-not-allowed":"cursor-pointer"),onClick:()=>{Q===B&&("connected"!==en.status?es({title:n("TOAST_NETWORK_STATUS_DISCONNECTED_TITLE"),description:n("TOAST_NETWORK_STATUS_DISCONNECTED_LOAD_DESCRIPTION"),variant:"destructive"}):(ea(),em(!0),eC()))},children:[ef?(0,a.jsx)(r.$,{className:"h-4 w-4 mr-1.5"}):(0,a.jsx)(A.Z,{className:"h-4 w-4 mr-1.5"}),n("LOAD")]})]})]}),H.length>0&&(0,a.jsx)(u,{className:"pb-0 rounded-t-lg w-fit","aria-label":"Manage your tabs",children:H.map(e=>(0,a.jsxs)(_,{className:"".concat(e.id===B?"data-[state=active]:text-white text-white data-[state=active]:pb-2 data-[state=active]:pt-1 data-[state=active]:border-b-4 border-white data-[state=active]:bg-primary bg-primary/30":"data-[state=active]:pb-4","  transition ease-linear data-[state=active]:h-11 data-[state=active]:shadow-none data-[state=active]:relative top-1 z-10 py-2 rounded-t-md flex justify-between items-center gap-x-2"),value:e.id,children:[(0,a.jsx)("span",{onClick:()=>et(e),className:"w-20 truncate",children:e.id}),e.id!==B&&(0,a.jsx)(k.Z,{className:"w-4 h-4",onClick:()=>ee(e.id)}),(0,a.jsx)("span",{className:"sr-only",children:n("CLOSE_TAB")})]},e.id))}),(0,a.jsxs)(T,{className:"h-[calc(100%-40px-48px)] relative",value:Q,children:[(0,a.jsx)("div",{className:"pt-1 absolute top-0 overflow-y-auto rounded-b-lg w-full h-[calc(100%-40px-12px)] bg-muted",children:(0,a.jsx)(I.ZP,{readOnly:Q!==B,className:"text-lg",value:Q===B?el:null===(t=M.peek())||void 0===t?void 0:t.content,onChange:er,extensions:[(0,w.Vs)()]})}),(0,a.jsx)("div",{className:"absolute bottom-0 w-full flex justify-end",children:(0,a.jsxs)(l.z,{className:"".concat(e_||Q!==B?"cursor-not-allowed bg-muted/50 hover:bg-muted/50":"cursor-pointer"," "),variant:"muted",onClick:()=>{Q===B&&er("")},children:[(0,a.jsx)(L.Z,{className:"h-4 w-4 mr-1.5"}),n("CLEAR")]})})]})]}),(0,a.jsxs)("div",{className:"relative flex flex-col",children:[(0,a.jsx)(E.k,{className:"mb-2",children:n("CONSOLE")}),(0,a.jsx)(V.Resizable,{handle:(0,a.jsx)("span",{className:"absolute left-0 top-0 z-50 w-full h-2 cursor-row-resize ".concat(m?"bg-secondary":"","  rounded-lg")}),axis:"y",height:o,onResizeStart:()=>{Y(!0)},onResize:(e,t)=>{f(t.size.height)},onResizeStop:()=>{Y(!1)},resizeHandles:["n"],maxConstraints:[0,Z-28-8],children:(0,a.jsxs)("div",{className:"relative w-full bg-muted px-4 py-2 whitespace-pre-line font-mono rounded-lg overflow-y-auto",style:{height:o},children:[(0,a.jsx)("div",{className:"text-primary",children:eS}),(0,a.jsx)("div",{className:"text-destructive",children:eN}),(0,a.jsx)("div",{ref:ex})]})}),(0,a.jsxs)("div",{className:"absolute -bottom-12 w-full flex flex-row justify-end space-x-4",children:[(0,a.jsxs)(l.z,{variant:"destructive",className:"text-background ".concat(e_||Q!==B?"cursor-not-allowed hover:bg-destructive/50 bg-destructive/50":"bg-destructive"),onClick:()=>{if(Q===B){if("connected"!==en.status){es({title:n("TOAST_NETWORK_STATUS_DISCONNECTED_TITLE"),description:n("TOAST_NETWORK_STATUS_DISCONNECTED_BREAK_DESCRIPTION"),variant:"destructive"});return}eO()}},children:[(0,a.jsx)(P.Z,{className:"h-4 w-4 mr-1.5"}),n("BREAK")]}),(0,a.jsxs)(l.z,{variant:"positive",className:"".concat(ed||e_||Q!==B?"bg-positive/30 hover:bg-positive/30 backdrop-blur-md cursor-not-allowed":"text-primary cursor-pointer"),onClick:()=>{e_||ed||Q!==B||("connected"!==en.status?es({title:n("TOAST_NETWORK_STATUS_DISCONNECTED_TITLE"),description:n("TOAST_NETWORK_STATUS_DISCONNECTED_RUN_DESCRIPTION"),variant:"destructive"}):(ea(),ep()))},children:[ed?(0,a.jsx)(r.$,{className:"h-4 w-4 mr-1.5"}):(0,a.jsx)(z.Z,{className:"h-4 w-4 mr-1.5"}),n("RUN")]}),(0,a.jsxs)(l.z,{variant:"secondary",className:"".concat(e_||ed||Q!==B?"bg-secondary/50 hover:bg-secondary/50 backdrop-blur-md cursor-not-allowed":"cursor-pointer"),onClick:()=>{e_||ed||Q!==B||("connected"!==en.status?es({title:n("TOAST_NETWORK_STATUS_DISCONNECTED_TITLE"),description:n("TOAST_NETWORK_STATUS_DISCONNECTED_DEPLOY_DESCRIPTION"),variant:"destructive"}):(ea(),ej(!0)))},children:[(0,a.jsx)(K.Z,{className:"h-4 w-4 mr-1.5"}),n("DEPLOY")]})]})]}),(0,a.jsx)(i.aR,{open:eb,onOpenChange:ej,children:(0,a.jsxs)(i.zJ,{children:[(0,a.jsx)(i.dh,{}),(0,a.jsxs)(i._T,{children:[(0,a.jsx)(i.f$,{children:n("ALERT_CODE_DEPLOY_TITLE")}),(0,a.jsx)(i.yT,{children:n("ALERT_CODE_DEPLOY_DESCRIPTION")}),(0,a.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,a.jsx)(i.le,{onClick:()=>{eT(!1)},children:n("CANCEL")}),(0,a.jsx)(i.OL,{onClick:()=>{eT(!0)},children:n("CONFIRM")})]})]})]})})]})}}}]);